'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _Context = require('./Context');

var _Context2 = _interopRequireDefault(_Context);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var SayPrimitive = function (_React$Component) {
  (0, _inherits3.default)(SayPrimitive, _React$Component);

  function SayPrimitive(props) {
    (0, _classCallCheck3.default)(this, SayPrimitive);

    var _this = (0, _possibleConstructorReturn3.default)(this, (SayPrimitive.__proto__ || (0, _getPrototypeOf2.default)(SayPrimitive)).call(this, props));

    _this.handleBoundary = _this.handleBoundary.bind(_this);
    _this.handleEnd = _this.handleEnd.bind(_this);
    _this.handleError = _this.handleError.bind(_this);
    _this.handleStart = _this.handleStart.bind(_this);

    _this.state = { id: Date.now() + Math.random() };
    return _this;
  }

  (0, _createClass3.default)(SayPrimitive, [{
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      // TODO: Should dequeue self on unmount
      this.unmounted = true;

      this.props.context.cancel(this.state.id).catch(function (err) {
        return 0;
      });
    }
  }, {
    key: 'handleBoundary',
    value: function handleBoundary(event) {
      !this.unmounted && this.props.onBoundary && this.props.onBoundary(event);
    }
  }, {
    key: 'handleEnd',
    value: function handleEnd(event) {
      !this.unmounted && this.props.onEnd && this.props.onEnd(event);
    }
  }, {
    key: 'handleError',
    value: function handleError(event) {
      !this.unmounted && this.props.onError && this.props.onError(event);
    }
  }, {
    key: 'handleStart',
    value: function handleStart(event) {
      !this.unmounted && this.props.onStart && this.props.onStart(event);
    }
  }, {
    key: 'shouldComponentUpdate',
    value: function shouldComponentUpdate(nextProps) {
      return nextProps.speak !== this.props.speak;
    }
  }, {
    key: 'render',
    value: function render() {
      var _this2 = this;

      (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
        var _props, context, lang, pitch, rate, text, voice, volume, id;

        return _regenerator2.default.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                _props = _this2.props, context = _props.context, lang = _props.lang, pitch = _props.pitch, rate = _props.rate, text = _props.speak, voice = _props.voice, volume = _props.volume;
                id = _this2.state.id;


                context.speak({
                  id: id,
                  lang: lang,
                  onBoundary: _this2.handleBoundary,
                  onEnd: _this2.handleEnd,
                  onError: _this2.handleError,
                  onStart: _this2.handleStart,
                  pitch: pitch,
                  rate: rate,
                  text: text,
                  voice: voice,
                  volume: volume
                });

              case 3:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, _this2);
      }))().catch(function (err) {
        return console.error(err);
      });

      return false;
    }
  }]);
  return SayPrimitive;
}(_react2.default.Component);

var SayPrimitiveWithContext = function SayPrimitiveWithContext(props) {
  return _react2.default.createElement(
    _Context2.default.Consumer,
    null,
    function (context) {
      return _react2.default.createElement(
        SayPrimitive,
        (0, _extends3.default)({
          context: context
        }, props),
        props.children
      );
    }
  );
};

SayPrimitiveWithContext.propTypes = {
  lang: _propTypes2.default.string,
  pitch: _propTypes2.default.number,
  rate: _propTypes2.default.number,
  onBoundary: _propTypes2.default.func,
  onEnd: _propTypes2.default.func,
  onError: _propTypes2.default.func,
  onStart: _propTypes2.default.func,
  speak: _propTypes2.default.string,
  voice: _propTypes2.default.oneOfType([_propTypes2.default.any, _propTypes2.default.func]),
  volume: _propTypes2.default.number
};

exports.default = SayPrimitiveWithContext;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TYXlQcmltaXRpdmUuanMiXSwibmFtZXMiOlsiU2F5UHJpbWl0aXZlIiwicHJvcHMiLCJoYW5kbGVCb3VuZGFyeSIsImJpbmQiLCJoYW5kbGVFbmQiLCJoYW5kbGVFcnJvciIsImhhbmRsZVN0YXJ0Iiwic3RhdGUiLCJpZCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidW5tb3VudGVkIiwiY29udGV4dCIsImNhbmNlbCIsImNhdGNoIiwiZXZlbnQiLCJvbkJvdW5kYXJ5Iiwib25FbmQiLCJvbkVycm9yIiwib25TdGFydCIsIm5leHRQcm9wcyIsInNwZWFrIiwibGFuZyIsInBpdGNoIiwicmF0ZSIsInRleHQiLCJ2b2ljZSIsInZvbHVtZSIsImNvbnNvbGUiLCJlcnJvciIsImVyciIsIlJlYWN0IiwiQ29tcG9uZW50IiwiU2F5UHJpbWl0aXZlV2l0aENvbnRleHQiLCJjaGlsZHJlbiIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsInN0cmluZyIsIm51bWJlciIsImZ1bmMiLCJvbmVPZlR5cGUiLCJhbnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7QUFDQTs7OztBQUVBOzs7Ozs7SUFFTUEsWTs7O0FBQ0osd0JBQVlDLEtBQVosRUFBbUI7QUFBQTs7QUFBQSxrSkFDWEEsS0FEVzs7QUFHakIsVUFBS0MsY0FBTCxHQUFzQixNQUFLQSxjQUFMLENBQW9CQyxJQUFwQixPQUF0QjtBQUNBLFVBQUtDLFNBQUwsR0FBaUIsTUFBS0EsU0FBTCxDQUFlRCxJQUFmLE9BQWpCO0FBQ0EsVUFBS0UsV0FBTCxHQUFtQixNQUFLQSxXQUFMLENBQWlCRixJQUFqQixPQUFuQjtBQUNBLFVBQUtHLFdBQUwsR0FBbUIsTUFBS0EsV0FBTCxDQUFpQkgsSUFBakIsT0FBbkI7O0FBRUEsVUFBS0ksS0FBTCxHQUFhLEVBQUVDLElBQUlDLEtBQUtDLEdBQUwsS0FBYUMsS0FBS0MsTUFBTCxFQUFuQixF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bENsQixTQUFPZSxvQkFBVUMsTUFSaUI7QUFTbENYLFNBQU9VLG9CQUFVSSxTQUFWLENBQW9CLENBQUNKLG9CQUFVSyxHQUFYLEVBQWdCTCxvQkFBVUcsSUFBMUIsQ0FBcEIsQ0FUMkI7QUFVbENaLFVBQVFTLG9CQUFVRTtBQVZnQixDQUFwQzs7a0JBYWVMLHVCIiwiZmlsZSI6IlNheVByaW1pdGl2ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgQ29udGV4dCBmcm9tICcuL0NvbnRleHQnO1xuXG5jbGFzcyBTYXlQcmltaXRpdmUgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIHRoaXMuaGFuZGxlQm91bmRhcnkgPSB0aGlzLmhhbmRsZUJvdW5kYXJ5LmJpbmQodGhpcyk7XG4gICAgdGhpcy5oYW5kbGVFbmQgPSB0aGlzLmhhbmRsZUVuZC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlRXJyb3IgPSB0aGlzLmhhbmRsZUVycm9yLmJpbmQodGhpcyk7XG4gICAgdGhpcy5oYW5kbGVTdGFydCA9IHRoaXMuaGFuZGxlU3RhcnQuYmluZCh0aGlzKTtcblxuICAgIHRoaXMuc3RhdGUgPSB7IGlkOiBEYXRlLm5vdygpICsgTWF0aC5yYW5kb20oKSB9O1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgLy8gVE9ETzogU2hvdWxkIGRlcXVldWUgc2VsZiBvbiB1bm1vdW50XG4gICAgdGhpcy51bm1vdW50ZWQgPSB0cnVlO1xuXG4gICAgdGhpcy5wcm9wcy5jb250ZXh0LmNhbmNlbCh0aGlzLnN0YXRlLmlkKS5jYXRjaChlcnIgPT4gMCk7XG4gIH1cblxuICBoYW5kbGVCb3VuZGFyeShldmVudCkge1xuICAgICF0aGlzLnVubW91bnRlZCAmJiB0aGlzLnByb3BzLm9uQm91bmRhcnkgJiYgdGhpcy5wcm9wcy5vbkJvdW5kYXJ5KGV2ZW50KTtcbiAgfVxuXG4gIGhhbmRsZUVuZChldmVudCkge1xuICAgICF0aGlzLnVubW91bnRlZCAmJiB0aGlzLnByb3BzLm9uRW5kICYmIHRoaXMucHJvcHMub25FbmQoZXZlbnQpO1xuICB9XG5cbiAgaGFuZGxlRXJyb3IoZXZlbnQpIHtcbiAgICAhdGhpcy51bm1vdW50ZWQgJiYgdGhpcy5wcm9wcy5vbkVycm9yICYmIHRoaXMucHJvcHMub25FcnJvcihldmVudCk7XG4gIH1cblxuICBoYW5kbGVTdGFydChldmVudCkge1xuICAgICF0aGlzLnVubW91bnRlZCAmJiB0aGlzLnByb3BzLm9uU3RhcnQgJiYgdGhpcy5wcm9wcy5vblN0YXJ0KGV2ZW50KTtcbiAgfVxuXG4gIHNob3VsZENvbXBvbmVudFVwZGF0ZShuZXh0UHJvcHMpIHtcbiAgICByZXR1cm4gbmV4dFByb3BzLnNwZWFrICE9PSB0aGlzLnByb3BzLnNwZWFrO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIChhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IGNvbnRleHQsIGxhbmcsIHBpdGNoLCByYXRlLCBzcGVhazogdGV4dCwgdm9pY2UsIHZvbHVtZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAgIGNvbnRleHQuc3BlYWsoe1xuICAgICAgICBpZCxcbiAgICAgICAgbGFuZyxcbiAgICAgICAgb25Cb3VuZGFyeTogdGhpcy5oYW5kbGVCb3VuZGFyeSxcbiAgICAgICAgb25FbmQ6IHRoaXMuaGFuZGxlRW5kLFxuICAgICAgICBvbkVycm9yOiB0aGlzLmhhbmRsZUVycm9yLFxuICAgICAgICBvblN0YXJ0OiB0aGlzLmhhbmRsZVN0YXJ0LFxuICAgICAgICBwaXRjaCxcbiAgICAgICAgcmF0ZSxcbiAgICAgICAgdGV4dCxcbiAgICAgICAgdm9pY2UsXG4gICAgICAgIHZvbHVtZVxuICAgICAgfSk7XG4gICAgfSkoKS5jYXRjaChlcnIgPT4gY29uc29sZS5lcnJvcihlcnIpKTtcblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5jb25zdCBTYXlQcmltaXRpdmVXaXRoQ29udGV4dCA9IHByb3BzID0+XG4gIDxDb250ZXh0LkNvbnN1bWVyPlxuICAgIHsgY29udGV4dCA9PlxuICAgICAgPFNheVByaW1pdGl2ZVxuICAgICAgICBjb250ZXh0PXsgY29udGV4dCB9XG4gICAgICAgIHsgLi4ucHJvcHMgfVxuICAgICAgPlxuICAgICAgICB7IHByb3BzLmNoaWxkcmVuIH1cbiAgICAgIDwvU2F5UHJpbWl0aXZlPlxuICAgIH1cbiAgPC9Db250ZXh0LkNvbnN1bWVyPlxuXG5TYXlQcmltaXRpdmVXaXRoQ29udGV4dC5wcm9wVHlwZXMgPSB7XG4gIGxhbmc6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHBpdGNoOiBQcm9wVHlwZXMubnVtYmVyLFxuICByYXRlOiBQcm9wVHlwZXMubnVtYmVyLFxuICBvbkJvdW5kYXJ5OiBQcm9wVHlwZXMuZnVuYyxcbiAgb25FbmQ6IFByb3BUeXBlcy5mdW5jLFxuICBvbkVycm9yOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25TdGFydDogUHJvcFR5cGVzLmZ1bmMsXG4gIHNwZWFrOiBQcm9wVHlwZXMuc3RyaW5nLFxuICB2b2ljZTogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmFueSwgUHJvcFR5cGVzLmZ1bmNdKSxcbiAgdm9sdW1lOiBQcm9wVHlwZXMubnVtYmVyXG59O1xuXG5leHBvcnQgZGVmYXVsdCBTYXlQcmltaXRpdmVXaXRoQ29udGV4dFxuIl19